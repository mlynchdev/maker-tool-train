# Caddyfile for Training & Reservation System
# Replace training.example.com with your actual domain

{
    # Global options
    email admin@example.com
}

training.example.com {
    # Main application
    reverse_proxy app:3000

    # Health check endpoint
    handle /health {
        respond "OK" 200
    }

    # Webhook endpoint for Cal.com
    # Allow internal network only in production
    handle /api/webhooks/calcom {
        reverse_proxy app:3000
    }

    # Security headers
    header {
        X-Content-Type-Options nosniff
        X-Frame-Options DENY
        X-XSS-Protection "1; mode=block"
        Referrer-Policy strict-origin-when-cross-origin
        -Server
    }

    # Compression
    encode gzip zstd

    # Logging
    log {
        output file /var/log/caddy/access.log
        format json
    }
}

# Optional: Cal.com admin interface (internal access only)
# Uncomment and configure for admin access
# calcom-admin.example.com {
#     # Restrict to internal IPs or VPN
#     @internal {
#         remote_ip 10.0.0.0/8 172.16.0.0/12 192.168.0.0/16
#     }
#     handle @internal {
#         reverse_proxy calcom-web:3000
#     }
#     respond "Forbidden" 403
# }
